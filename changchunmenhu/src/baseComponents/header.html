<!DOCTYPE html>
<html lang="zh_CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    .white:hover {
      color: red
    }

    .nav_left {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .isDesensitization {
      cursor: pointer;
      position: relative;
      margin-right: 50px;
    }

    .explainHint {
      width: 204px;
      height: 103px;
      position: absolute;
      /* background-image: url(../img/tuominbeijing.svg); */
      background: #fff;
      box-shadow: 0px 2px 10px 0px rgba(0, 0, 0, 0.15);
      z-index: 1;
      left: -30px;
      top: 60px;
      display: none;
    }

    .explainHint-text {
      font-size: 12px;
      font-family: PingFangSC-Regular;
      font-weight: 400;
      color: rgba(71, 130, 234, 1);
      height: 42px;
      padding: 0 12px;
      line-height: 42px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.09);
    }

    .explainHint-desc {
      height: 60px;
      padding: 12px;
      font-size: 12px;
      font-family: PingFangSC-Regular;
      font-weight: 400;
      color: rgba(0, 0, 0, 0.65);
      line-height: initial;
    }

    .explainHint-triangle {
      width: 16px;
      height: 16px;
      background: #fff;
      position: relative;
      top: -110px;
      left: 34px;
      transform: rotate(45deg);
      z-index: 1;
      box-shadow:
        -1px -1px 1px 0px rgba(0, 0, 0, .02),
        /*上边阴影*/
        -1px -1px 1px 0px rgba(0, 0, 0, .02),
        /*左边阴影*/
        5px 0px 5px 0px #ffffff,
        /*右边阴影*/
        0px 5px 5px 0px #fff;
      /*下边阴影*/
    }
  </style>
  <!-- header -->
  <!-- <link rel="stylesheet" href="../css/WbaseFd.css"> -->
  <!-- <link rel="stylesheet" href=".../src/css/WbaseFd.css"> -->
  <link rel="stylesheet" href="../css/iconfont.css">
</head>

<body>

  <nav class="nav">

    <div class="nav_top">
      <div class="nav_left">
        <h3>
          <a href="../index/index.html">
            <div class="log">

              <!-- <img class="imgchange" src="../img/Wlogo_qy.png" alt=""> -->

            </div>
          </a>
        </h3>
        <!-- 脱敏操作 -->
        <div class="isDesensitization">
          <!-- <img src="../img/weituomin1.svg" alt=""> -->
          <img src="" alt="">
          <div class="explainHint">
            <div class="explainHint-text">
              <!-- 安全模式中 -->
            </div>
            <div class="explainHint-desc">
              <!-- 关键信息已为您进行脱敏处理 点击可切换“免脱敏模式” -->
            </div>
            <div class="explainHint-triangle"></div>
          </div>
        </div>
        <!-- <h4>数据账户系统</h4> -->
      </div>
      <div class="nav_right">
        <ul>
          <li> <a href="../index/index.html">首页</a> </li>
          <li> <a href="../person/esInformation.html">企业信息</a> </li>
          <li> <a href="../subscriptions/subscriptions.html">关注订阅</a> </li>
          <li> <a href="../Appliedmap/appliedmap.html">应用图谱</a> </li>
          <li> <a href="../personalCenter/personalCenter.html">企业空间</a> </li>
          <link rel="shortcut icon " type="images/x-icon" href="./icofont.ico">
          <li class="lastli white">
            <!-- <span class="search_top glyphicon" aria-hidden="true"></span> -->
            <a href="javascript:;" class="persion_toqp" id="username"></a>
            <span class="iconfont white1 icon-gengduo "></span>
            <div class="lastliBox">
              <!-- <i>意见反馈</i> -->
              <i class="i2" id="goOut">退出系统</i>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>

</body>
<script src="../js/iconfont.js"></script>
<script src="../libs/axios.min.js"></script>
<script src="../js/api.js"></script>
<!-- <script src="../js/common.js"></script> -->
<script>
  // function getUrlParam(name) {
  //   var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
  //   var r = window.location.search.substr(1).match(reg); //匹配目标参数
  //   if (r != null) return unescape(r[2]);
  //   return null; //返回参数值
  // }
  // console.log(getUrlParam("type"))
  $('.lastli').hover(function () {
    $('.lastliBox').css('display', 'block')
  }, function () {
    $('.lastliBox').css('display', 'none')
  })
  $('#goOut').on('click', function () {

    layout()
  })


  var main_Name = sessionStorage.getItem('username')
  $('#username').html(main_Name)

  function layout() {
    lhRequest.service({
      url: '/logout',
      method: 'get',
      // data: {
      //     username: 'zhangsan',
      //     password: '123456'
      // }
    }).then(function (msg) {
      // console.log('msg')
      sessionStorage.removeItem("username")
      sessionStorage.removeItem("token")
      window.location.href = '/login/login.html';
    }).catch(function (error) {
      console.log('error')
      console.log(error)
    })

  }

  $(document).ready(function () {
    //获取nav距离顶部的距离
    var navtop = $("nav").offset().top;
    // var natop = document.querySelector('nav').scrollHeight
    var index_navH = $('.index_nav').height();
    var identifying = sessionStorage.getItem('identifying');
    sessionStorage.removeItem('identifying')
    $(document).scroll(function () {
      //获取滚动条滚动的高度
      var scroltop = $(document).scrollTop();
      // 由于效果不一样，首页需导航单独处理  qsq
      if (identifying == '首页') {
        if (scroltop > index_navH) {
          $('.nav').css({ 'background': '#FFFFFF', "position": "fixed" })
          $('.log').css({
            'background': 'url(../img/newlogo_qy.png)',
            'float': 'left',
            ' margin-right': '12px',
            'width': '182px',
            'height': '32px',
            'background-size': '100% 100%'
          });
          $('.nav .nav_top .nav_right ul li').css({ 'opacity': '1' })
          $('.nav_right li').css({ 'color': 'rgb(110, 109, 122)' })
          $('.nav_right li a').css({ 'color': 'rgb(110, 109, 122)' })
          $('.nav_right li:nth-of-type(1) a').css({ 'color': 'rgb(72, 108, 216)' })
          $(".nav_right li a").hover(function () {
            $(this).parent().css({ 'opacity': '1', 'color': 'rgb(72, 108, 216)' });
            $(this).css({ 'color': 'rgb(72, 108, 216)' });
            $('.nav_right li').css({})
          }, function () {
            $(this).parent().css({ 'opacity': '1', 'color': 'rgb(110, 109, 122)' });
            $(this).css({ 'color': 'rgb(110, 109, 122)' });
            $('.nav_right li:nth-of-type(1) a').css({ 'color': 'rgb(72, 108, 216)' });
          })
        } else {
          $('.nav').css({ 'background': 'transparent', "position": "absolute" })
          $('.log').css({
            'background': 'url(../img/Wlogo_qy.png)',
            'float': 'left',
            ' margin-right': '12px',
            'width': '182px',
            'height': '32px',
            'background-size': '100% 100%'
          });
          $('.nav .nav_top .nav_right ul li').css({ 'opacity': '.5' })
          $('.nav_right li').css({ 'color': '#fff' })
          $('.nav_right li a').css({ 'color': '#fff' })
          $('.nav_right li:nth-of-type(1) a').css({ 'color': '#fff' })
          $(".nav_right li a").hover(function () {
            $(this).parent().css({ 'opacity': '1', 'color': '#fff' });
            $(this).css({ 'color': '#fff' });
          }, function () {
            $(this).parent().css({ 'opacity': '.5', 'color': '#fff' });
            $(this).css({ 'color': '#fff' });
            $('.nav_right li:nth-of-type(1) a').css({ 'color': '#fff' });
          })
        }
      } else {
        if (scroltop) {
          $(".nav").css({
            "position": "fixed",
            "left": "0px",
            "top": "0px",
            "width": "100%",
            "z-index": "666",
            // "border-bottom": "1px solid #f8f8f8",
            'background': '#FFFFFF',
            "box-shadow": "0 1px 1px rgba(0, 0, 0, 0.1)"

          })
          $('body').css({
            "padding-top": navtop
          })
        } else {
          $(".nav").css({
            "position": "",
            "left": "",
            "top": "0",
            "width": "",
            "box-shadow": "0 0 0 "
          })
          $('body').css({
            "padding-top": "0"
          })
        }
      }

    })
  })

  // <!-- 脱敏操作 -->、
  desensitizationAction();
  function desensitizationAction() {
    var src;
    if (sessionStorage.getItem('control') == 'Y') {
      $('.isDesensitization').children().attr('src', '../img/yituomin1.svg');
      $('.explainHint-text').html('免脱敏模式中').css({ 'color': 'rgba(255,161,71,1)' });
      $('.explainHint-desc').html('关键信息已可免脱敏查看 点击可切换“安全模式”')
    } else {
      $('.isDesensitization').children().attr('src', '../img/weituomin1.svg');
      $('.explainHint-text').html('安全模式中').css({ 'color': 'rgba(71, 130, 234, 1)' });
      $('.explainHint-desc').html('关键信息已为您进行脱敏处理 点击可切换“免脱敏模式”')
    }
    var state = true;
    $('.isDesensitization')
      // 移入更换图标
      .mouseover(function () {
        src = $(this).children().attr('src').match(/img(.*)/)[1];
        if (src == '/weituomin1.svg') {
          $(this).children().attr('src', '../img/weituomin2.svg');
        } else if (src == '/yituomin1.svg') {
          $(this).children().attr('src', '../img/yituomin2.svg');
        }
        $('.explainHint').css({ "display": "block" });
      })
      // // 移出更换图标
      .mouseout(function () {
        src = $(this).children().attr('src').match(/img(.*)/)[1];
        if (src == '/weituomin2.svg') {
          $(this).children().attr('src', '../img/weituomin1.svg');
        } else if (src == '/yituomin2.svg') {
          $(this).children().attr('src', '../img/yituomin1.svg');
        }
        $('.explainHint').css({ "display": "none" });
      })
      .click(function () {
        var _this = $(this);
        lhRequest.service({
          url: '/desensitize/getEmailBySpace',
          method: 'get'
        }).then(function (msg) {
          if (msg.data.code == 200) {
            if (msg.data.data) {
              if (msg.data.data.status) {
                significant('identification', msg.data.data.email);
              } else {
                significant('binding', '');
              }
            } else {
              significant('binding', '');
            }

          }
        }).catch(function (error) {
          console.log('error')
          console.log(error)
        })
        function significant(condition, val) {
          if (sessionStorage.getItem('control') != 'Y') {
            lyTool.verification('账户安全验证', '为了保障您的隐私信息安全', '验证通过后开启免脱敏模式', function (mailboxVal) {
              if (state) {
                state = false;
                lhRequest.service({
                  url: '/desensitize/getverificationcode?link=' + mailboxVal,
                  method: 'get',
                }).then(function (msg) {
                  if (msg.data.code == 200) {
                    var num = 60;
                    var time = setInterval(function () {
                      num--;
                      $('.acquire').html(num + 's').attr('disabled', 'disabled').css({ 'opacity': '.6' });
                      if (num == 0) {
                        clearInterval(time);
                        $('.acquire').html('获取验证码').removeAttr('disabled').css({ 'opacity': '1' });;
                        state = true;
                      }
                    }, 1000)
                    lyTool.toast("请查收验证码");
                  }
                }).catch(function (error) {
                  console.log('error')
                  console.log(error)
                })
              }

            }, function (codeVal) {
              lhRequest.service({
                url: '/desensitize/checkverificationcode',
                method: 'post',
                data: {
                  code: codeVal
                }
              }).then(function (msg) {
                if (msg.data.code == 200) {
                  // _this.children().attr('src', '../img/yituomin1.svg');
                  sessionStorage.setItem('control', 'Y');
                  window.location.reload()
                  lyTool.toast("验证成功");
                } else if (msg.data.code == 999) {
                  lyTool.toast("验证码错误！");
                }
              }).catch(function (error) {
                console.log('error')
                console.log(error)
              })
            }, condition, val, 1)
          } else {
            lyTool.alert('你确认取消免脱敏？', function () {
              lhRequest.service({
                url: '/desensitize/closenotdesensitize',
                method: 'post',
              }).then(function (msg) {
                if (msg.data.code == 200) {
                  sessionStorage.setItem('control', 'N');
                  window.location.reload()
                  lyTool.toast("成功取消免脱敏");
                }
              }).catch(function (error) {
                console.log('error')
                console.log(error)
              })
            })
          }
        }
      })
  }
</script>

</html>